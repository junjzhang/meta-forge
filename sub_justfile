name := `basename "$PWD"`

build: clean
  rattler-build build -r recipe.yaml \
  {{ if path_exists("variant_config.yaml") == 'true' { "--variant-config " + "variant_config.yaml" } else { "" } }} \
  --no-include-recipe --experimental \
  --output-dir ../output \
  -c nvidia/label/cuda-12.4.0 \
  -c nvidia \
  -c pytorch \
  -c conda-forge \
  --no-build-id --keep-build \
  2>&1 | tee output_file.txt
  # -vvvv \

clean:
  -rm -rf ../output/bld/rattler-build_{{name}}/
  -rm -rf ../output/**/{{name}}-*

venv:
  chmod +x ../output/bld/rattler-build_{{name}}/work/conda_build.sh
  chmod +x ../output/bld/rattler-build_{{name}}/work/build_env.sh
  -source ../output/bld/rattler-build_{{name}}/work/build_env.sh
  cd ../output/bld/rattler-build_{{name}}/work && exec zsh

